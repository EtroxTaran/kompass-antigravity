services:
  neo4j:
    image: neo4j:5.26-community
    container_name: neo4j-graphiti
    restart: unless-stopped
    environment:
      - NEO4J_AUTH=neo4j/demodemo
      - NEO4J_PLUGINS='["apoc"]'
    ports:
      - '7474:7474'
      - '7687:7687'
    volumes:
      - neo4j-data:/data
      - neo4j-logs:/logs
    healthcheck:
      test:
        [
          'CMD',
          'wget',
          '--no-verbose',
          '--tries=1',
          '--spider',
          'http://localhost:7474',
        ]
      interval: 10s
      timeout: 5s
      retries: 5

  graphiti-mcp:
    image: zepai/knowledge-graph-mcp:latest
    container_name: graphiti-mcp
    restart: unless-stopped
    depends_on:
      neo4j:
        condition: service_healthy
    env_file:
      - .env
    environment:
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=demodemo
    command:
      [
        'uv',
        'run',
        'graphiti_mcp_server.py',
        '--transport',
        'sse',
        '--group-id',
        'kompass-memory',
      ]
    ports:
      - '8000:8000'
    volumes:
      - graphiti-data:/app/data
      - graphiti-config:/app/config

volumes:
  graphiti-data:
  graphiti-config:
  neo4j-data:
  neo4j-logs:
