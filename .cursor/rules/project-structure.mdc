---
description: Monorepo structure, domain-driven organization, file naming conventions, and module boundaries
globs: ["**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx"]
alwaysApply: true
---

# Project Structure & Organization

## Monorepo Structure

This is a **pnpm workspace monorepo** with strict directory boundaries:

- **Backend**: `apps/backend/` (NestJS)
- **Frontend**: `apps/frontend/` (React + Vite PWA)
- **Shared**: `packages/shared/` (TypeScript types, utilities, validation)
- **Tests**: `tests/` (E2E Playwright tests, integration tests, performance tests)
- **Documentation**: `docs/` (All project documentation)

### Rules

- NEVER create files outside these designated directories
- NEVER create duplicate copies of files - use git for versioning
- All shared code MUST be in `packages/shared/`
- All tests MUST be in `tests/` directory (E2E) or colocated with source (unit tests)
- All documentation MUST be in `docs/` directory (except standard root files listed below)

## Root Directory Files

### ✅ ALLOWED in Root Directory

Only these standard project files are allowed in root:

- `README.md` - Project overview and quick start guide
- `CHANGELOG.md` - Version history (if maintained)
- `LICENSE` - License file
- `CONTRIBUTING.md` - Contribution guidelines (optional, can be in `docs/`)
- Configuration files: `package.json`, `tsconfig.json`, `turbo.json`, `.eslintrc.js`, `.prettierrc.js`, `.gitignore`, etc.
- CI/CD configs: `.github/workflows/`, `.husky/`, etc.

### ❌ FORBIDDEN in Root Directory

These types of files MUST be in `docs/` directory:

- Implementation reports: `IMPLEMENTATION_*.md`, `SETUP_COMPLETE.md`
- Development guides: `DEVELOPMENT.md`, `USAGE_GUIDE.md`
- Coding standards: `CODING_STANDARDS.md`
- Migration guides: `MIGRATION_GUIDE.md`
- API documentation: `API_UPDATES.md`
- Architecture documentation
- Any project-specific documentation beyond README

### Documentation Organization

All documentation MUST be organized in `docs/` directory:

```
docs/
├── README.md                    # Documentation index
├── CHANGELOG.md                 # Version history
├── MIGRATION_GUIDE.md           # Migration instructions
├── API_UPDATES.md               # API documentation
├── architectur/                 # Architecture docs
├── reviews/                     # Review documents
├── product-vision/              # Product vision docs
├── personas/                    # User personas
└── implementation/              # Implementation reports (NEW)
    ├── IMPLEMENTATION_COMPLETE.md
    ├── IMPLEMENTATION_SUMMARY.md
    └── SETUP_COMPLETE.md
```

**Rule**: If you're creating a `.md` file and it's not `README.md`, `CHANGELOG.md`, or `LICENSE`, it MUST go in `docs/` directory.

## Domain-Driven Directory Organization

### Backend Module Structure

Backend modules MUST follow domain structure: `customer/`, `opportunity/`, `project/`, `invoice/`, etc.

Each backend module MUST contain:

```
apps/backend/src/modules/{entity}/
├── {entity}.module.ts          # NestJS module
├── {entity}.controller.ts      # HTTP endpoints
├── {entity}.service.ts         # Business logic
├── {entity}.repository.ts      # Data access
├── dto/                        # Data transfer objects
│   ├── create-*.dto.ts
│   ├── update-*.dto.ts
│   └── response-*.dto.ts
├── entities/                   # Domain entities
│   └── {entity}.entity.ts
└── __tests__/                 # Unit tests
    └── *.spec.ts
```

### Frontend Feature Structure

Frontend features MUST follow feature-based structure:

```
apps/frontend/src/features/{entity}/
├── components/                 # React components using shadcn/ui
├── hooks/                      # Custom hooks
├── services/                   # API clients
├── store/                      # Redux Toolkit slices or Zustand stores
└── types/                      # TypeScript types
```

## Module Boundaries

### Backend Module Boundaries

- Backend services MUST NOT import from other module services directly
- Use dependency injection and interfaces for cross-module communication
- NEVER create circular dependencies between modules
- Shared business logic MUST be extracted to `packages/shared/`

### Frontend Feature Boundaries

- Frontend features MUST NOT directly access other feature stores
- Use shared state management (Redux Toolkit) for cross-feature data
- Shared UI components MUST be in `apps/frontend/src/components/ui/` (shadcn)
- Shared utilities MUST be in `packages/shared/`

## File Naming Conventions

### Backend Files

- **kebab-case** for file names: `customer.service.ts`, `create-customer.dto.ts`
- **PascalCase** for classes: `CustomerService`, `CreateCustomerDto`
- **camelCase** for functions and variables: `getCustomerById`, `customerId`

### Frontend Files

- **PascalCase** for React components: `CustomerList.tsx`, `CustomerCard.tsx`
- **camelCase** for hooks: `useCustomer.ts`, `useCustomerFilters.ts`
- **kebab-case** for utility files: `api-client.ts`, `date-utils.ts`

### Test Files

- **Unit tests**: `*.spec.ts` (colocated with source)
- **E2E tests**: `*.e2e.spec.ts` (in `tests/e2e/`)
- **Integration tests**: `*.integration.spec.ts` (in `tests/integration/`)

### Constants Files

- **UPPER_SNAKE_CASE** for constants: `MAX_RETRY_ATTEMPTS`, `DEFAULT_TIMEOUT`
- Constants MUST be in files named `*.constants.ts`

## Examples

### ✅ CORRECT: Proper Backend Module Structure

```
apps/backend/src/modules/customer/
├── customer.module.ts
├── customer.controller.ts
├── customer.service.ts
├── customer.repository.ts
├── dto/
│   ├── create-customer.dto.ts
│   ├── update-customer.dto.ts
│   └── response-customer.dto.ts
├── entities/
│   └── customer.entity.ts
└── __tests__/
    ├── customer.service.spec.ts
    └── customer.controller.spec.ts
```

### ✅ CORRECT: Proper Frontend Feature Structure

```
apps/frontend/src/features/customer/
├── components/
│   ├── CustomerList.tsx
│   ├── CustomerCard.tsx
│   └── CustomerForm.tsx
├── hooks/
│   ├── useCustomer.ts
│   └── useCustomerFilters.ts
├── services/
│   └── customer-api.ts
├── store/
│   └── customer-slice.ts
└── types/
    └── customer.types.ts
```

### ❌ WRONG: Files Outside Designated Directories

```
❌ src/customer.ts                    # Should be in apps/backend/src/modules/customer/
❌ components/Customer.tsx           # Should be in apps/frontend/src/features/customer/components/
❌ utils/date.ts                     # Should be in packages/shared/src/utils/
```

### ❌ WRONG: Documentation in Root Directory

```
❌ IMPLEMENTATION_COMPLETE.md         # Should be in docs/implementation/
❌ IMPLEMENTATION_SUMMARY.md         # Should be in docs/implementation/
❌ DEVELOPMENT.md                    # Should be in docs/
❌ CODING_STANDARDS.md               # Should be in docs/
❌ SETUP_COMPLETE.md                 # Should be in docs/implementation/
❌ USAGE_GUIDE.md                    # Should be in docs/
```

### ✅ CORRECT: Documentation Organization

```
✅ README.md                         # Root - project overview
✅ docs/DEVELOPMENT.md               # Development guide
✅ docs/CODING_STANDARDS.md          # Coding standards
✅ docs/implementation/              # Implementation reports
✅ docs/implementation/IMPLEMENTATION_COMPLETE.md
✅ docs/implementation/SETUP_COMPLETE.md
```

### ❌ WRONG: Circular Dependencies

```typescript
// ❌ customer.service.ts
import { OpportunityService } from '../opportunity/opportunity.service';

// ❌ opportunity.service.ts  
import { CustomerService } from '../customer/customer.service';
```

**Solution**: Extract shared logic to `packages/shared/` or use interfaces/events.

## References

- File Organization: `.cursor/rules/file-organization.mdc` - Complete file organization standards
- Git Workflow: `.cursor/rules/git-workflow.mdc` - No file duplication rules
- Architecture Documentation: `docs/architectur/Projekt KOMPASS – Architekturdokumentation (Zielarchitektur).md`
- Data Model: `docs/reviews/DATA_MODEL_SPECIFICATION.md`
